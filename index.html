<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Webgis Clockboard Zone Evan - Pro Dashboard</title>
    
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/L.Control.Locate.min.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/leaflet.photon.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
    :root {
        --sidebar-width: 360px;
        --primary-dark: #0f1724;
        --accent-color: #00d2ff;
        --text-muted: #a2a5b9;
    }

    html, body { height: 100%; margin: 0; font-family: 'Inter', sans-serif; background: #000; }
    #dashboard-wrapper { position: relative; height: 100vh; width: 100vw; overflow: hidden; }

    /* SIDEBAR - default off-screen (hidden) */
    #sidebar {
        position: absolute;
        left: 0;
        top: 0;
        width: var(--sidebar-width);
        height: 100%;
        background: linear-gradient(180deg, rgba(10,12,20,0.98), rgba(20,22,30,0.98));
        color: #fff;
        z-index: 1400;
        transform: translateX(calc(-1 * var(--sidebar-width)));
        transition: transform 300ms cubic-bezier(.2,.9,.2,1);
        box-shadow: 0 10px 30px rgba(0,0,0,0.6);
        display: flex;
        flex-direction: column;
        border-right: 1px solid rgba(255,255,255,0.03);
    }
    /* When wrapper has .sidebar-open, slide sidebar in */
    #dashboard-wrapper.sidebar-open #sidebar {
        transform: translateX(0);
    }

    .sidebar-header { padding: 20px; background: linear-gradient(to bottom, rgba(0,210,255,0.03), transparent); }
    .sidebar-header h4 { margin:0; color: var(--accent-color); font-weight:700; text-transform:uppercase; font-size:1.05rem; }

    .sidebar-content { padding: 16px; overflow-y: auto; flex:1; }
    .sidebar-footer { padding: 12px 16px; font-size: 13px; color: rgba(255,255,255,0.7); border-top: 1px solid rgba(255,255,255,0.02); }

    /* MAP - selalu mengisi viewport; when sidebar-open on wide screens the map is pushed */
    #map { position: absolute; left:0; right:0; top:0; bottom:0; z-index: 100; transition: transform 300ms cubic-bezier(.2,.9,.2,1); transform: translateX(0); will-change: transform; }

    /* push behavior: move map to right by sidebar width when open */
    @media (min-width: 901px) {
        #dashboard-wrapper.sidebar-open #map { transform: translateX(var(--sidebar-width)); }
    }
    /* on small screens do NOT push (keep overlay) */
    @media (max-width: 900px) {
        #dashboard-wrapper.sidebar-open #map { transform: none; }
        #sidebar { width: 90vw; max-width: 360px; transform: translateX(calc(-1 * 90vw)); }
        #dashboard-wrapper.sidebar-open #sidebar { transform: translateX(0); }
    }

    /* small toggle button on map */
    .map-toggle {
        position: absolute;
        top: 12px;
        left: 12px;
        z-index: 1500;
        border-radius: 10px;
        background: rgba(10,10,15,0.75);
        color: #fff;
        border: none;
        padding: 8px 10px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.45);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: transform 180ms ease, box-shadow 180ms ease;
    }
    .map-toggle:active { transform: scale(.98); }
    .map-toggle .icon { transition: transform 300ms ease; display:inline-block; }
    /* rotate icon when open */
    #dashboard-wrapper.sidebar-open .map-toggle .icon { transform: rotate(90deg); }

    /* make sure leaflet controls appear above map but below sidebar toggle */
    .leaflet-control-container { z-index: 1200; }

    /* legend small style */
    .legend-panel, .layer-toggle-panel {
        background: rgba(255,255,255,0.02);
        border-radius: 10px;
        padding: 12px;
        margin-bottom: 12px;
        border: 1px solid rgba(255,255,255,0.03);
    }
    .layer-item { display:flex; align-items:center; gap:10px; padding:8px; border-radius:8px; cursor:pointer; }
    .layer-item:hover { background: rgba(255,255,255,0.02); }
    .layer-item input { margin-right: 8px; accent-color: var(--accent-color); }

    /* accessible focus */
    .map-toggle:focus { outline: 2px solid rgba(0,210,255,0.12); }

    /* ===========================
       HIDE TEXT ON LEAFLET.MEASURE BUTTON (keep toggle + accessible labels)
       =========================== */
    .leaflet-control-measure .leaflet-control-measure-toggle a {
      width: 36px;
      height: 36px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
      box-sizing: border-box;
      text-indent: -9999px;   /* sembunyikan teks */
      overflow: hidden;
      white-space: nowrap;
    }
    /* Optional icon styling (uncomment if you want a fontawesome icon) */
//  content: "\f545"; /* coba code icon; bisa disesuaikan */
//  font-weight: 900;
//  font-size: 14px;
//  color: #fff;
//}
    </style>
</head>
<body>
<div id="dashboard-wrapper" class="">
    <aside id="sidebar" aria-label="Sidebar">
        <div class="sidebar-header">
            <h4>WEBGIS CLOCKBOARD ZONE SURAKARTA EVAN</h4>
            <div class="d-flex align-items-center mt-2">
                <span class="badge bg-primary me-2" style="font-size: 0.6rem;">EVAN DASHBOARD</span>
                <p class="small text-muted mb-0" style="font-size: 0.7rem; color: rgba(255,255,255,0.6);">Clockboard Analysis 2025</p>
            </div>
        </div>

        <div class="sidebar-content">
            <div class="mb-3 p-3 rounded-3" style="background: linear-gradient(45deg, rgba(0,210,255,0.03), rgba(54,153,255,0.04)); border-left: 3px solid var(--accent-color);">
                <p class="small text-light mb-0" style="line-height: 1.4; color: #dfe9f1;">
                    Visualisasi spasial <strong>Multi-Criteria Evaluation (MCE)</strong> dan zonasi strategis Clockboard Kota Surakarta.
                </p>
            </div>

            <div class="layer-toggle-panel">
                <div class="mb-2" style="font-weight:700; color:var(--accent-color); display:flex; gap:8px; align-items:center;">
                    <i class="fas fa-layer-group"></i> Kontrol Lapisan
                </div>
                <div>
                    <div style="font-size:0.78rem; color: var(--text-muted); margin-bottom:6px;">Tampilan Dasar</div>
                    <label class="layer-item"><input type="radio" id="basemap-google" name="basemap" value="google" checked> Google Satellite</label>
                    <label class="layer-item"><input type="radio" id="basemap-osm" name="basemap" value="osm"> OpenStreetMap</label>
                    <label class="layer-item"><input type="radio" id="basemap-dark" name="basemap" value="dark"> Dark Matter (Retina)</label>
                </div>

                <hr style="border:0.5px solid rgba(255,255,255,0.03); margin:10px 0;">

                <div>
                    <div style="font-size:0.78rem; color: var(--text-muted); margin-bottom:6px;">Analisis Data</div>
                    <label class="layer-item"><input type="checkbox" id="overlay-clockboard" checked> Clockboard Zone</label>
                    <label class="layer-item"><input type="checkbox" id="overlay-mce"> MCE Surakarta</label>
                    <label class="layer-item"><input type="checkbox" id="overlay-batas-admin"> Batas Administrasi</label>
                </div>
            </div>

            <div class="legend-panel" style="margin-top:12px;">
                <div style="font-weight:700; color:var(--accent-color); display:flex; gap:8px; align-items:center;">
                    <i class="fas fa-list-ul"></i> Legenda Peta
                </div>
                <div id="sidebar-legend-content" style="margin-top:8px; font-size:0.9rem; color:#e6eef8;"></div>
            </div>

            <div class="p-3" style="background: rgba(54,153,255,0.04); border-radius:8px; border:1px solid rgba(54,153,255,0.06);">
                <h6 class="small mb-1 text-info" style="color:var(--accent-color);">Insight Navigasi</h6>
                <p class="small mb-0" style="font-size: 0.78rem; color: #a8b0c0;">Aktifkan/nonaktifkan layer melalui checkbox di sini atau menggunakan kontrol layer di pojok kanan atas peta.</p>
            </div>
        </div>

        <div class="sidebar-footer">
            <div style="height:1px;background:rgba(255,255,255,0.02); margin-bottom:8px;"></div>
            <div>Created by <strong>Evan</strong> &copy; 2025</div>
            <div class="small" style="color: rgba(255,255,255,0.6);">Urban & Regional Planning</div>
        </div>
    </aside>

    <div id="map" role="application" aria-label="Peta utama"></div>

    <button id="sidebar-toggle" class="map-toggle" aria-label="Toggle sidebar" title="Toggle sidebar">
        <i class="icon fas fa-bars"></i>
        <span class="visually-hidden">Toggle sidebar</span>
    </button>
</div>

<!-- qgis2web + leaflet + plugins -->
<script src="js/qgis2web_expressions.js"></script>
<script src="js/leaflet.js"></script>
<script src="js/L.Control.Layers.Tree.min.js"></script>
<script src="js/L.Control.Locate.min.js"></script>
<script src="js/leaflet.rotatedMarker.js"></script>
<script src="js/leaflet.pattern.js"></script>
<script src="js/leaflet-hash.js"></script>
<script src="js/Autolinker.min.js"></script>
<script src="js/rbush.min.js"></script>
<script src="js/labelgun.min.js"></script>
<script src="js/labels.js"></script>
<script src="js/leaflet.photon.js"></script>
<script src="js/leaflet-measure.js"></script>

<!-- data -->
<script src="data/MultiCriteriaEvaluationSurakarta_3.js"></script>
<script src="data/AnalisisClockboardZoneSurakarta_4.js"></script>
<script src="data/BatasAdminSurakarta_5.js"></script>

<script>
/* ========================
   --- BEGIN qgis2web code (dipertahankan) ---
   ======================== */
var highlightLayer;
function highlightFeature(e) {
    highlightLayer = e.target;
    if (e.target.feature.geometry.type === 'LineString' || e.target.feature.geometry.type === 'MultiLineString') {
      highlightLayer.setStyle({ color: 'rgba(255, 255, 0, 1.00)' });
    } else {
      highlightLayer.setStyle({ fillColor: 'rgba(255, 255, 0, 1.00)', fillOpacity: 1 });
    }
    highlightLayer.openPopup();
}

var map = L.map('map', { zoomControl: false, maxZoom: 28, minZoom: 1 })
    .fitBounds([[-7.597069084198594,110.76663390539312],[-7.520191120726702,110.87154808329655]]);
var hash = new L.Hash(map);
map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});

function removeEmptyRowsFromPopupContent(content, feature) {
 var tempDiv = document.createElement('div');
 tempDiv.innerHTML = content;
 var rows = tempDiv.querySelectorAll('tr');
 for (var i = 0; i < rows.length; i++) {
     var td = rows[i].querySelector('td.visible-with-data');
     var key = td ? td.id : '';
     if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
         rows[i].parentNode.removeChild(rows[i]);
     }
 }
 return tempDiv.innerHTML;
}
function addClassToPopupIfMedia(content, popup) {
    var tempDiv = document.createElement('div');
    tempDiv.innerHTML = content;
    var imgTd = tempDiv.querySelector('td img');
    if (imgTd) {
        var src = imgTd.getAttribute('src');
        if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
            popup._contentNode.classList.add('media');
            setTimeout(function() { popup.update(); }, 10);
        } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
            var audio = document.createElement('audio');
            audio.controls = true; audio.src = src;
            imgTd.parentNode.replaceChild(audio, imgTd);
            popup._contentNode.classList.add('media');
            setTimeout(function() { popup.setContent(tempDiv.innerHTML); popup.update(); }, 10);
        } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
            var video = document.createElement('video');
            video.controls = true; video.src = src;
            video.style.maxHeight = "60vh"; video.style.maxWidth = "60vw";
            imgTd.parentNode.replaceChild(video, imgTd);
            popup._contentNode.classList.add('media');
            video.addEventListener('loadedmetadata', function() { popup.update(); });
            setTimeout(function() { popup.setContent(tempDiv.innerHTML); popup.update(); }, 10);
        } else { popup._contentNode.classList.remove('media'); }
    } else { popup._contentNode.classList.remove('media'); }
}

var bounds_group = new L.featureGroup([]);
function setBounds() {}

/* Tile + GeoJSON layers (pertahankan definisi lama Anda) */
map.createPane('pane_GoogleSatellite_0'); map.getPane('pane_GoogleSatellite_0').style.zIndex = 400;
var layer_GoogleSatellite_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', { pane:'pane_GoogleSatellite_0', opacity:1.0, attribution:'', minZoom:1, maxZoom:28, minNativeZoom:0, maxNativeZoom:19 });

map.createPane('pane_OpenStreetMap_1'); map.getPane('pane_OpenStreetMap_1').style.zIndex = 401;
var layer_OpenStreetMap_1 = L.tileLayer('http://tile.osm.org/{z}/{x}/{y}.png', { pane:'pane_OpenStreetMap_1', opacity:1.0, attribution:'', minZoom:1, maxZoom:28, minNativeZoom:0, maxNativeZoom:19 });

map.createPane('pane_DarkMatterretina_2'); map.getPane('pane_DarkMatterretina_2').style.zIndex = 402;
var layer_DarkMatterretina_2 = L.tileLayer('https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png', { pane:'pane_DarkMatterretina_2', opacity:1.0, attribution:'', minZoom:1, maxZoom:28, minNativeZoom:0, maxNativeZoom:20 });

/* contoh popup/style layer - salin dari file Anda sebelumnya */
function pop_MultiCriteriaEvaluationSurakarta_3(feature, layer) {
    layer.on({ mouseout: function(e) {
        for (var i in e.target._eventParents) {
            if (typeof e.target._eventParents[i].resetStyle === 'function') {
                e.target._eventParents[i].resetStyle(e.target);
            }
        }
        if (typeof layer.closePopup == 'function') layer.closePopup(); else layer.eachLayer(function(feature){ feature.closePopup(); });
    }, mouseover: highlightFeature });
    var popupContent = '<table><tr><td colspan="2"><strong>DN</strong><br />' + (feature.properties['DN'] !== null ? autolinker.link(String(feature.properties['DN']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr></table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) { addClassToPopupIfMedia(content, e.popup); });
    layer.bindPopup(content, { maxHeight: 400 });
}
function style_MultiCriteriaEvaluationSurakarta_3_0(feature) {
    switch(String(feature.properties['DN'])) {
        case '1': return { pane:'pane_MultiCriteriaEvaluationSurakarta_3', stroke:false, fill:true, fillOpacity:1, fillColor:'rgba(215,25,28,1.0)', interactive:true };
        case '2': return { pane:'pane_MultiCriteriaEvaluationSurakarta_3', stroke:false, fill:true, fillOpacity:1, fillColor:'rgba(253,174,97,1.0)', interactive:true };
        case '3': return { pane:'pane_MultiCriteriaEvaluationSurakarta_3', stroke:false, fill:true, fillOpacity:1, fillColor:'rgba(255,255,191,1.0)', interactive:true };
        case '4': return { pane:'pane_MultiCriteriaEvaluationSurakarta_3', stroke:false, fill:true, fillOpacity:1, fillColor:'rgba(171,221,164,1.0)', interactive:true };
        case '5': return { pane:'pane_MultiCriteriaEvaluationSurakarta_3', stroke:false, fill:true, fillOpacity:1, fillColor:'rgba(43,131,186,1.0)', interactive:true };
    }
}
map.createPane('pane_MultiCriteriaEvaluationSurakarta_3'); map.getPane('pane_MultiCriteriaEvaluationSurakarta_3').style.zIndex = 403;
map.getPane('pane_MultiCriteriaEvaluationSurakarta_3').style['mix-blend-mode'] = 'color-dodge';
var layer_MultiCriteriaEvaluationSurakarta_3 = new L.geoJson(json_MultiCriteriaEvaluationSurakarta_3, {
    attribution:'', interactive:true, dataVar:'json_MultiCriteriaEvaluationSurakarta_3', layerName:'layer_MultiCriteriaEvaluationSurakarta_3',
    pane:'pane_MultiCriteriaEvaluationSurakarta_3', onEachFeature: pop_MultiCriteriaEvaluationSurakarta_3, style: style_MultiCriteriaEvaluationSurakarta_3_0
});
bounds_group.addLayer(layer_MultiCriteriaEvaluationSurakarta_3);

function pop_AnalisisClockboardZoneSurakarta_4(feature, layer) {
    layer.on({ mouseout: function(e) {
        for (var i in e.target._eventParents) {
            if (typeof e.target._eventParents[i].resetStyle === 'function') {
                e.target._eventParents[i].resetStyle(e.target);
            }
        }
        if (typeof layer.closePopup == 'function') layer.closePopup(); else layer.eachLayer(function(feature){ feature.closePopup(); });
    }, mouseover: highlightFeature });
    var popupContent = '<table>\
            <tr><td class="visible-with-data" id="zone_id" colspan="2"><strong>Zona Clockboard</strong><br />' + (feature.properties['zone_id'] !== null ? autolinker.link(String(feature.properties['zone_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr>\
            <tr><td colspan="2">' + (feature.properties['zone_sum'] !== null ? autolinker.link(String(feature.properties['zone_sum']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr>\
            <tr><td colspan="2">' + (feature.properties['zone_mean'] !== null ? autolinker.link(String(feature.properties['zone_mean']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr>\
            <tr><td class="visible-with-data" id="Source" colspan="2"><strong>Source</strong><br />' + (feature.properties['Source'] !== null ? autolinker.link(String(feature.properties['Source']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) { addClassToPopupIfMedia(content, e.popup); });
    layer.bindPopup(content, { maxHeight: 400 });
}
function style_AnalisisClockboardZoneSurakarta_4_0(feature) {
    if (feature.properties['zone_mean'] >= 143.319368 && feature.properties['zone_mean'] <= 178.262560 ) return { pane:'pane_AnalisisClockboardZoneSurakarta_4', opacity:1, color:'rgba(0,0,0,1.0)', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(215,25,28,1.0)', interactive:true };
    if (feature.properties['zone_mean'] >= 178.262560 && feature.properties['zone_mean'] <= 199.836309 ) return { pane:'pane_AnalisisClockboardZoneSurakarta_4', opacity:1, color:'rgba(0,0,0,1.0)', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(253,174,97,1.0)', interactive:true };
    if (feature.properties['zone_mean'] >= 199.836309 && feature.properties['zone_mean'] <= 211.293532 ) return { pane:'pane_AnalisisClockboardZoneSurakarta_4', opacity:1, color:'rgba(0,0,0,1.0)', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(255,255,191,1.0)', interactive:true };
    if (feature.properties['zone_mean'] >= 211.293532 && feature.properties['zone_mean'] <= 226.771112 ) return { pane:'pane_AnalisisClockboardZoneSurakarta_4', opacity:1, color:'rgba(0,0,0,1.0)', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(171,221,164,1.0)', interactive:true };
    if (feature.properties['zone_mean'] >= 226.771112 && feature.properties['zone_mean'] <= 248.438013 ) return { pane:'pane_AnalisisClockboardZoneSurakarta_4', opacity:1, color:'rgba(0,0,0,1.0)', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(43,131,186,1.0)', interactive:true };
}
map.createPane('pane_AnalisisClockboardZoneSurakarta_4'); map.getPane('pane_AnalisisClockboardZoneSurakarta_4').style.zIndex = 404;
map.getPane('pane_AnalisisClockboardZoneSurakarta_4').style['mix-blend-mode'] = 'overlay';
var layer_AnalisisClockboardZoneSurakarta_4 = new L.geoJson(json_AnalisisClockboardZoneSurakarta_4, {
    attribution:'', interactive:true, dataVar:'json_AnalisisClockboardZoneSurakarta_4', layerName:'layer_AnalisisClockboardZoneSurakarta_4',
    pane:'pane_AnalisisClockboardZoneSurakarta_4', onEachFeature: pop_AnalisisClockboardZoneSurakarta_4, style: style_AnalisisClockboardZoneSurakarta_4_0
});
bounds_group.addLayer(layer_AnalisisClockboardZoneSurakarta_4);

function pop_BatasAdminSurakarta_5(feature, layer) {
    layer.on({ mouseout: function(e) {
        for (var i in e.target._eventParents) {
            if (typeof e.target._eventParents[i].resetStyle === 'function') {
                e.target._eventParents[i].resetStyle(e.target);
            }
        }
        if (typeof layer.closePopup == 'function') layer.closePopup(); else layer.eachLayer(function(feature){ feature.closePopup(); });
    }, mouseover: highlightFeature });
    var popupContent = '<table></table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) { addClassToPopupIfMedia(content, e.popup); });
    layer.bindPopup(content, { maxHeight: 400 });
}
function style_BatasAdminSurakarta_5_0(feature) {
    switch(String(feature.properties['WADMKC'])) {
        case 'Banjarsari': return { pane:'pane_BatasAdminSurakarta_5', opacity:1, color:'rgba(255,255,255,1.0)', dashArray:'5.0,1.0', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(68,1,84,1.0)', interactive:false };
        case 'Jebres': return { pane:'pane_BatasAdminSurakarta_5', opacity:1, color:'rgba(255,255,255,1.0)', dashArray:'5.0,1.0', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(59,82,139,1.0)', interactive:false };
        case 'Laweyan': return { pane:'pane_BatasAdminSurakarta_5', opacity:1, color:'rgba(255,255,255,1.0)', dashArray:'5.0,1.0', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(33,144,141,1.0)', interactive:false };
        case 'Pasar Kliwon': return { pane:'pane_BatasAdminSurakarta_5', opacity:1, color:'rgba(255,255,255,1.0)', dashArray:'5.0,1.0', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(93,201,99,1.0)', interactive:false };
        case 'Serengan': return { pane:'pane_BatasAdminSurakarta_5', opacity:1, color:'rgba(255,255,255,1.0)', dashArray:'5.0,1.0', weight:1.0, fill:true, fillOpacity:1, fillColor:'rgba(253,231,37,1.0)', interactive:false };
    }
}
map.createPane('pane_BatasAdminSurakarta_5'); map.getPane('pane_BatasAdminSurakarta_5').style.zIndex = 405;
map.getPane('pane_BatasAdminSurakarta_5').style['mix-blend-mode'] = 'hard-light';
var layer_BatasAdminSurakarta_5 = new L.geoJson(json_BatasAdminSurakarta_5, {
    attribution:'', interactive:false, dataVar:'json_BatasAdminSurakarta_5', layerName:'layer_BatasAdminSurakarta_5',
    pane:'pane_BatasAdminSurakarta_5', onEachFeature: pop_BatasAdminSurakarta_5, style: style_BatasAdminSurakarta_5_0
});
bounds_group.addLayer(layer_BatasAdminSurakarta_5);

/* Photon control (opsional) */
const url = {"Nominatim OSM": "https://nominatim.openstreetmap.org/search?format=geojson&addressdetails=1&", "France BAN": "https://api-adresse.data.gouv.fr/search?"}
var photonControl = L.control.photon({
    url: url["Nominatim OSM"],
    feedbackLabel: '',
    position: 'topleft',
    includePosition: true,
    initial: true,
}).addTo(map);
photonControl._container.childNodes[0].style.borderRadius="10px"

var overlaysTree = [
    {label: 'Batas Admin Surakarta<br /><table><tr><td style="text-align: center;"><img src="legend/BatasAdminSurakarta_5_Banjarsari0.png" /></td><td>Banjarsari</td></tr><tr><td style="text-align: center;"><img src="legend/BatasAdminSurakarta_5_Jebres1.png" /></td><td>Jebres</td></tr><tr><td style="text-align: center;"><img src="legend/BatasAdminSurakarta_5_Laweyan2.png" /></td><td>Laweyan</td></tr><tr><td style="text-align: center;"><img src="legend/BatasAdminSurakarta_5_PasarKliwon3.png" /></td><td>Pasar Kliwon</td></tr><tr><td style="text-align: center;"><img src="legend/BatasAdminSurakarta_5_Serengan4.png" /></td><td>Serengan</td></tr></table>', layer: layer_BatasAdminSurakarta_5},
    {label: 'Analisis Clockboard Zone Surakarta<br /><table><tr><td style="text-align: center;"><img src="legend/AnalisisClockboardZoneSurakarta_4_Ring10.png" /></td><td>Ring 1</td></tr><tr><td style="text-align: center;"><img src="legend/AnalisisClockboardZoneSurakarta_4_Ring21.png" /></td><td>Ring 2</td></tr><tr><td style="text-align: center;"><img src="legend/AnalisisClockboardZoneSurakarta_4_Ring32.png" /></td><td>Ring 3</td></tr><tr><td style="text-align: center;"><img src="legend/AnalisisClockboardZoneSurakarta_4_Ring43.png" /></td><td>Ring 4</td></tr><tr><td style="text-align: center;"><img src="legend/AnalisisClockboardZoneSurakarta_4_Ring54.png" /></td><td>Ring 5</td></tr></table>', layer: layer_AnalisisClockboardZoneSurakarta_4},
    {label: '<b>Multi-Criteria Evaluation Surakarta</b>', collapsed: true, selectAllCheckbox: true, children: [
        {label: 'Multi-Criteria Evaluation Surakarta<br /><table><tr><td style="text-align: center;"><img src="legend/MultiCriteriaEvaluationSurakarta_3_SangatTinggi0.png" /></td><td>Sangat Tinggi</td></tr><tr><td style="text-align: center;"><img src="legend/MultiCriteriaEvaluationSurakarta_3_Tinggi1.png" /></td><td>Tinggi </td></tr><tr><td style="text-align: center;"><img src="legend/MultiCriteriaEvaluationSurakarta_3_Sedang2.png" /></td><td>Sedang</td></tr><tr><td style="text-align: center;"><img src="legend/MultiCriteriaEvaluationSurakarta_3_Rendah3.png" /></td><td>Rendah</td></tr><tr><td style="text-align: center;"><img src="legend/MultiCriteriaEvaluationSurakarta_3_SangatRendah4.png" /></td><td>Sangat Rendah</td></tr></table>', layer: layer_MultiCriteriaEvaluationSurakarta_3},
        {label: "Dark Matter (retina)", layer: layer_DarkMatterretina_2}
    ]},
    {label: "OpenStreetMap", layer: layer_OpenStreetMap_1},
    {label: "Google Satelite", layer: layer_GoogleSatellite_0, radioGroup: 'bm' },
];

var lay = L.control.layers.tree(null, overlaysTree,{ collapsed: true, }).addTo(map);
setBounds();

/* Label logic and reset calls (mengandalkan labels.js dari proyek Anda) */
try {
    layer_BatasAdminSurakarta_5.eachLayer(function(layer) {
        layer.bindTooltip((layer.feature.properties['WADMKC'] !== null?String('<div style="color: #323232; font-size: 6pt;">' + layer.feature.properties['WADMKC']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_BatasAdminSurakarta_5'});
    });
} catch (e) {}

/* inject legend */
(function renderInitialLegend(){
    var container = document.getElementById('sidebar-legend-content');
    if (!container) return;
    container.innerHTML = '';
    overlaysTree.forEach(function(item){
        var div = document.createElement('div');
        div.style.padding = '6px 0';
        div.innerHTML = item.label || '';
        container.appendChild(div);
    });
})();

/* controls */
L.control.zoom({ position: 'topright' }).addTo(map);
L.control.locate({ position: 'topright' }).addTo(map);
new L.Control.Measure({ position: 'topright', primaryLengthUnit: 'meters' }).addTo(map);

/* ========================
   --- CLEANUP MEASURE BUTTON TEXT (keep functionality & accessibility)
   ======================== */
setTimeout(function(){
    // plugin biasanya membuat .leaflet-control-measure .leaflet-control-measure-toggle a
    var btn = document.querySelector('.leaflet-control-measure .leaflet-control-measure-toggle a');
    if (!btn) {
        // fallback: coba selector lain
        btn = document.querySelector('.leaflet-control-measure a');
    }
    if (btn) {
        // kosongkan teks visual (CSS sudah memindahkan teks dengan text-indent)
        btn.textContent = '';
        // tetap sediakan tooltip dan label untuk aksesibilitas
        btn.setAttribute('title', 'Measure');
        btn.setAttribute('aria-label', 'Measure');
        // jika ingin menampilkan icon via pseudo-element, tambahkan kelas dan sesuaikan CSS
        btn.classList.add('compact-control');
    }
}, 80);

/* ========================
   --- INITIAL LAYER STATE: only Google Satellite + Clockboard Zone
   ======================== */
// Pastikan hanya basemap Google dan layer Clockboard ditambahkan saat startup.
// Remove terlebih dahulu agar tidak ada sisa, lalu tambahkan dua layer yang diinginkan.
try { map.removeLayer(layer_GoogleSatellite_0); } catch (e) {}
try { map.removeLayer(layer_OpenStreetMap_1); } catch (e) {}
try { map.removeLayer(layer_DarkMatterretina_2); } catch (e) {}
try { map.removeLayer(layer_BatasAdminSurakarta_5); } catch (e) {}
try { map.removeLayer(layer_MultiCriteriaEvaluationSurakarta_3); } catch (e) {}

map.addLayer(layer_GoogleSatellite_0);
map.addLayer(layer_AnalisisClockboardZoneSurakarta_4);

/* ========================
   --- ENHANCEMENTS: PUSH SIDEBAR ANIMATION & SYNC
   ======================== */
(function(){
    var wrapper = document.getElementById('dashboard-wrapper');
    var sidebar = document.getElementById('sidebar');
    var toggleBtn = document.getElementById('sidebar-toggle');
    var toggleIcon = toggleBtn.querySelector('.icon');

    // restore previous state
    var savedOpen = localStorage.getItem('sidebar-open');
    if (savedOpen === 'true') wrapper.classList.add('sidebar-open');

    // helper untuk memanggil invalidateSize setelah animasi
    function refreshMapAfterTransition() {
        if (window.map && typeof window.map.invalidateSize === 'function') {
            setTimeout(function(){ map.invalidateSize(); }, 220);
        }
    }

    // Toggle function
    function setSidebar(open) {
        if (open) wrapper.classList.add('sidebar-open'); else wrapper.classList.remove('sidebar-open');
        localStorage.setItem('sidebar-open', !!open);
        if (open) { toggleIcon.classList.remove('fa-bars'); toggleIcon.classList.add('fa-times'); }
        else { toggleIcon.classList.remove('fa-times'); toggleIcon.classList.add('fa-bars'); }

        var called = false;
        function onTransitionEnd(e) {
            if (e && e.target !== sidebar) return;
            if (called) return;
            called = true;
            sidebar.removeEventListener('transitionend', onTransitionEnd);
            refreshMapAfterTransition();
        }
        sidebar.addEventListener('transitionend', onTransitionEnd);
        setTimeout(function(){ if (!called) refreshMapAfterTransition(); }, 400);
    }

    // bind toggle button
    toggleBtn.addEventListener('click', function(e){
        e.stopPropagation();
        setSidebar(!wrapper.classList.contains('sidebar-open'));
    });

    // close on map click in mobile mode
    map.on('click', function(){
        if (window.innerWidth <= 900 && wrapper.classList.contains('sidebar-open')) {
            setSidebar(false);
        }
    });

    // keep checkboxes/radios in sync with map layers
    function updateCheckboxes() {
        try {
            document.getElementById('overlay-batas-admin').checked = map.hasLayer(layer_BatasAdminSurakarta_5);
            document.getElementById('overlay-clockboard').checked = map.hasLayer(layer_AnalisisClockboardZoneSurakarta_4);
            document.getElementById('overlay-mce').checked = map.hasLayer(layer_MultiCriteriaEvaluationSurakarta_3);
        } catch (e) {}
    }
    var cbBatas = document.getElementById('overlay-batas-admin');
    var cbClock = document.getElementById('overlay-clockboard');
    var cbMCE = document.getElementById('overlay-mce');
    if (cbBatas) cbBatas.addEventListener('change', function(){ this.checked ? map.addLayer(layer_BatasAdminSurakarta_5) : map.removeLayer(layer_BatasAdminSurakarta_5); });
    if (cbClock) cbClock.addEventListener('change', function(){ this.checked ? map.addLayer(layer_AnalisisClockboardZoneSurakarta_4) : map.removeLayer(layer_AnalisisClockboardZoneSurakarta_4); });
    if (cbMCE) cbMCE.addEventListener('change', function(){ this.checked ? map.addLayer(layer_MultiCriteriaEvaluationSurakarta_3) : map.removeLayer(layer_MultiCriteriaEvaluationSurakarta_3); });

    // Basemap radios
    var rGoogle = document.getElementById('basemap-google');
    var rOsm = document.getElementById('basemap-osm');
    var rDark = document.getElementById('basemap-dark');
    function setBasemap(which) {
        map.removeLayer(layer_GoogleSatellite_0); map.removeLayer(layer_OpenStreetMap_1); map.removeLayer(layer_DarkMatterretina_2);
        if (which === 'google') map.addLayer(layer_GoogleSatellite_0);
        if (which === 'osm') map.addLayer(layer_OpenStreetMap_1);
        if (which === 'dark') map.addLayer(layer_DarkMatterretina_2);
    }
    if (rGoogle) rGoogle.addEventListener('change', function(){ if (this.checked) setBasemap('google'); });
    if (rOsm) rOsm.addEventListener('change', function(){ if (this.checked) setBasemap('osm'); });
    if (rDark) rDark.addEventListener('change', function(){ if (this.checked) setBasemap('dark'); });

    // keep inputs in sync if layers changed
    map.on('layeradd layerremove', function(){
        setTimeout(updateCheckboxes, 60);
        setTimeout(function(){
            if (map.hasLayer(layer_GoogleSatellite_0)) { if (rGoogle) rGoogle.checked = true; }
            else if (map.hasLayer(layer_OpenStreetMap_1)) { if (rOsm) rOsm.checked = true; }
            else if (map.hasLayer(layer_DarkMatterretina_2)) { if (rDark) rDark.checked = true; }
        }, 80);
    });

    // initial sync and icon set
    updateCheckboxes();
    if (wrapper.classList.contains('sidebar-open')) { toggleIcon.classList.remove('fa-bars'); toggleIcon.classList.add('fa-times'); } 
    else { toggleIcon.classList.remove('fa-times'); toggleIcon.classList.add('fa-bars'); }

    // ensure map resized on window resize (useful when switching between overlay/push breakpoint)
    window.addEventListener('resize', function(){
        setTimeout(function(){ map.invalidateSize(); }, 200);
    });

    // initial refresh
    setTimeout(function(){ map.invalidateSize(); }, 400);
})();
</script>
</body>
</html>
